<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Reactive Deer AI Game - Modular Terrain System</title>
    <link rel="stylesheet" href="styles/game.css">
</head>
<body>
    <div id="gameArea">Loading Modular Terrain System...</div>
    
    <div class="instructions fade-out">
    <strong>üéÆ REACTIVE DEER AI GAME - GEOLOGICAL TERRAIN SYSTEM</strong><br>
    <strong>Movement:</strong> Arrow Keys/WASD ‚Ä¢ <strong>Fog:</strong> F ‚Ä¢ <strong>Vision:</strong> +/- ‚Ä¢ <strong>Exploration:</strong> [/]<br>
    <strong>ü¶å DEER REACT INSTANTLY:</strong> Watch deer flee the moment you move toward them!<br>
    <strong>Debug Controls:</strong> Shift+D (debug) ‚Ä¢ Shift+S (scare all) ‚Ä¢ Shift+C (calm) ‚Ä¢ Shift+B (stats)<br>
    <strong>üèîÔ∏è GEOLOGICAL TERRAIN:</strong> 7 (mountains) ‚Ä¢ 8 (hills) ‚Ä¢ 9 (plains) ‚Ä¢ 0 (volcanic)<br>
    <strong>Classic Terrain:</strong> 1-3 (elevation) ‚Ä¢ <strong>Water:</strong> 4-6 (dry/normal/wet)<br>
    <strong>Analysis:</strong> T (terrain+geology) ‚Ä¢ G (geology details) ‚Ä¢ <strong>Regenerate:</strong> Ctrl+R<br>
    <em>Now with realistic geology that shapes mountains, valleys, and rivers!</em>
</div>
        
    <div class="status">
        <span id="undoStatus">Undo: Available</span>
        <span id="redoStatus">Redo: Available</span>
        <span id="position">Position: 0, 0</span>
        <span id="facing" class="facing-info">Facing: North</span>
    </div>

    <div class="loading-indicator" id="loadingIndicator">
        Loading terrain modules...
    </div>

    <!-- Load files in correct dependency order -->
    <script>
        // Global error handler
        window.addEventListener('error', function(e) {
            console.error('Script error:', e.error);
            const gameArea = document.getElementById('gameArea');
            if (gameArea && gameArea.innerHTML.includes('Loading')) {
                gameArea.innerHTML = 'Error loading game. Check console for details.';
            }
        });

        // Performance monitoring for reactive system
        window.deerReactionStats = {
            totalReactions: 0,
            averageReactionTime: 0,
            lastPlayerMove: 0
        };

        // Module loading tracker
        window.moduleLoadStatus = {
            worldSystem: false,
            fogSystem: false,
            treeSystem: false,
            deerSystem: false,
            terrainSystem: false
        };

        function updateLoadingStatus(moduleName) {
            window.moduleLoadStatus[moduleName] = true;
            const loadedCount = Object.values(window.moduleLoadStatus).filter(Boolean).length;
            const totalModules = Object.keys(window.moduleLoadStatus).length;
            
            const indicator = document.getElementById('loadingIndicator');
            if (indicator) {
                indicator.style.display = 'block';
                indicator.textContent = `Loading modules: ${loadedCount}/${totalModules}`;
                
                if (loadedCount === totalModules) {
                    setTimeout(() => {
                        indicator.style.display = 'none';
                    }, 2000);
                }
            }
            
            console.log(`‚úÖ ${moduleName} loaded (${loadedCount}/${totalModules})`);
        }
    </script>

    <!-- STEP 1: Core command system (no dependencies) -->
    <script src="src/commands/command-base.js"></script>
    <script src="src/commands/move-command.js"></script>
    <script src="src/systems/command-history.js"></script>
    
    <!-- STEP 2: Terrain module foundation (must load before world generators) -->
    <script src="src/systems/terrain-modules/terrain-module-base.js"></script>
    <script src="src/systems/terrain-modules/geology-module.js"></script>
    <script src="src/systems/terrain-modules/elevation-module.js"></script>    
    <script src="src/systems/terrain-modules/elevation-module.js"></script>
    <script src="src/systems/terrain-modules/hydrology-module.js"></script>
    <script src="src/systems/terrain-modules/vegetation-module.js"></script>
    
    <!-- STEP 3: World generation system (depends on modules) -->
    <script src="src/systems/simple-world-generator.js"></script>
    <script src="src/systems/simple-terrain-classifier.js"></script>
    
    <!-- STEP 4: Specialized subsystems -->
    <script src="src/systems/world-system.js" onload="updateLoadingStatus('worldSystem')"></script>
    <script src="src/systems/fog-of-war-system.js" onload="updateLoadingStatus('fogSystem')"></script>
    <script src="src/systems/tree-system.js" onload="updateLoadingStatus('treeSystem')"></script>
    
    <!-- STEP 5: Entity system (depends on terrain being ready) -->
    <script src="src/entities/game-object.js"></script>
    <script src="src/entities/deer.js"></script>
    <script src="src/systems/deer-system.js" onload="updateLoadingStatus('deerSystem')"></script>
    
    <!-- STEP 6: Rendering and UI -->
    <script src="src/systems/terrain-renderer.js"></script>
    <script src="src/systems/camera-system.js"></script>
    <script src="src/ui/ui-controller.js"></script>
    <script src="src/systems/input-handler.js"></script>
    
    <!-- STEP 7: Main terrain system coordinator (loads after all subsystems) -->
    <script src="src/systems/terrain-system.js" onload="updateLoadingStatus('terrainSystem')"></script>
    
    <!-- STEP 8: Main game engine (loads last - depends on everything) -->
    <script src="src/main.js"></script>
    <script src="src/game-engine.js"></script>
</body>
</html>